<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>√úbersicht - Laufadventskalender</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
    <link rel="stylesheet" href="/static/css/pixel-art.css">
</head>
<body>
    <div class="pixel-snow"></div>
    
    <nav class="pixel-nav">
        <div class="container" style="display: flex; justify-content: space-between; align-items: center;">
            <div class="pixel-font" style="color: var(--pixel-light); font-size: 16px;">
                üéÑ LAUFADVENTSKALENDER üèÉ‚Äç‚ôÇÔ∏è
            </div>
            <div>
                <a href="/" class="pixel-nav-item">üè† STARTSEITE</a>
                <a href="/overview" class="pixel-nav-item">üìä √úBERSICHT</a>
            </div>
        </div>
    </nav>

    <main class="container" style="padding-top: 40px;">
        <div class="columns is-centered">
            <div class="column is-full">
                <div class="pixel-card">
                    <h1 class="title pixel-font has-text-centered" style="color: var(--pixel-light);">
                        üìä √úBERSICHT ALLER TEILNEHMER
                    </h1>
                    
                    <div class="pixel-counter">
                        <span style="font-size: 1.2em;">üèÉ‚Äç‚ôÇÔ∏è</span>
                        <span>GESAMT KILOMETER: <strong id="totalKm">0</strong></span>
                    </div>
                    
                    <div class="pixel-overview-grid" id="overviewGrid">
                        <!-- Header row -->
                        <div class="pixel-overview-header"></div>
                        <!-- Day headers will be generated by JavaScript -->
                        
                        <!-- User rows will be generated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        async function loadOverview() {
            try {
                const response = await fetch('/api/overview');
                const data = await response.json();
                renderOverview(data);
                updateTotalKilometers(data);
            } catch (error) {
                console.error('Error loading overview:', error);
            }
        }

        function updateTotalKilometers(overviewData) {
            const totalKm = Object.values(overviewData).reduce((sum, user) => sum + user.kilometers, 0);
            document.getElementById('totalKm').textContent = totalKm;
        }

        function renderOverview(overviewData) {
            const grid = document.getElementById('overviewGrid');
            const users = Object.keys(overviewData);
            
            // Clear existing content except corner cell
            const cornerCell = grid.querySelector('.pixel-overview-header');
            grid.innerHTML = '';
            if (cornerCell) {
                grid.appendChild(cornerCell);
            }
            
            // Add day headers
            for (let day = 1; day <= 24; day++) {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'pixel-overview-header';
                dayHeader.textContent = day;
                grid.appendChild(dayHeader);
            }
            
            // Add user rows
            users.forEach(user => {
                // User header cell
                const userHeader = document.createElement('a');
                userHeader.className = 'pixel-overview-user';
                userHeader.href = `/${user}`;
                userHeader.textContent = user;
                grid.appendChild(userHeader);
                
                // User data cells for each day
                for (let day = 1; day <= 24; day++) {
                    const cell = document.createElement('div');
                    const isCompleted = overviewData[user].button_states[day];
                    cell.className = `pixel-overview-cell ${isCompleted ? 'completed' : ''}`;
                    cell.textContent = isCompleted ? '‚úì' : '';
                    grid.appendChild(cell);
                }
            });
        }

        // Initialize
        loadOverview();
    </script>
</body>
</html>